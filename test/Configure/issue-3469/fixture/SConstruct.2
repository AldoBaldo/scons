"""
This tests if we add/remove a test in between other tests if a rerun will properly cache the results.
Github issue #3469

MongoDB's problem is on 3rd run, a check which expects it's objectfile to have a main doesn't.
This means
This one does the following.
CheckLink
CheckHeader

"""
import textwrap

# DefaultEnvironment(tools=[])

vars = Variables()
vars.Add(BoolVariable('SKIP', 'Skip Middle Conf test', 0))
env = Environment(variables=vars)

print("SKIP:%s" % env['SKIP'])


conf = Configure(env, conf_dir='conf2')

if not env['SKIP']:
    int_size = conf.CheckTypeSize('unsigned int')
    print("Size:%d"%int_size)


if env['SKIP'] and not conf.CheckCXXHeader('math.h'):
    print('Math.h must be installed!')
    Exit(1)


#
# if not conf.CheckCHeader('stdlib.h'):
#     print('stdlib.h must be installed!')
#     Exit(1)
#
# if not conf.CheckCHeader('stdio.h'):
#     print('stdio.h must be installed!')
#     Exit(1)

env = conf.Finish()
